<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Logistics Rate Calculator</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 min-h-screen p-8">
    <div class="max-w-4xl mx-auto bg-white rounded-xl shadow-lg p-8">
        <h1 class="text-2xl font-bold text-gray-800 mb-6">Courier Rate Comparator</h1>
        
        <form id="rateForm" class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <div>
                <label class="block text-sm font-medium text-gray-700">Source Pincode</label>
                <input type="number" id="source" required class="mt-1 block w-full border border-gray-300 rounded-md p-2 shadow-sm focus:ring-blue-500 focus:border-blue-500">
            </div>
            <div>
                <label class="block text-sm font-medium text-gray-700">Destination Pincode</label>
                <input type="number" id="destination" required class="mt-1 block w-full border border-gray-300 rounded-md p-2 shadow-sm">
            </div>
            <div>
                <label class="block text-sm font-medium text-gray-700">Weight (kg)</label>
                <input type="number" step="0.1" id="weight" required class="mt-1 block w-full border border-gray-300 rounded-md p-2 shadow-sm">
            </div>
            <div>
                <label class="block text-sm font-medium text-gray-700">Order Value (for COD)</label>
                <input type="number" id="value" value="0" class="mt-1 block w-full border border-gray-300 rounded-md p-2 shadow-sm">
            </div>
            <div class="flex items-center space-x-4">
                <div class="flex items-center">
                    <input type="checkbox" id="is_cod" class="h-4 w-4 text-blue-600 border-gray-300 rounded">
                    <label for="is_cod" class="ml-2 block text-sm text-gray-900">COD Order</label>
                </div>
                <select id="mode" class="block w-full border border-gray-300 rounded-md p-2 shadow-sm">
                    <option value="Both">Both Modes</option>
                    <option value="Surface">Surface Only</option>
                    <option value="Air">Air Only</option>
                </select>
            </div>
            <div class="md:col-span-2">
                <button type="submit" class="w-full bg-blue-600 text-white font-bold py-3 rounded-md hover:bg-blue-700 transition duration-200">Compare Rates</button>
            </div>
        </form>

        <hr class="my-8">

        <div id="resultsArea" class="hidden">
            <h2 id="zoneBadge" class="inline-block px-3 py-1 rounded-full text-sm font-semibold bg-blue-100 text-blue-800 mb-4"></h2>
            <div class="overflow-x-auto">
                <table class="min-w-full divide-y divide-gray-200">
                    <thead class="bg-gray-50">
                        <tr>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Carrier</th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Mode</th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Base + Extra</th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">COD Fee</th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">GST (18%)</th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase font-bold">Total</th>
                        </tr>
                    </thead>
                    <tbody id="resultsBody" class="bg-white divide-y divide-gray-200"></tbody>
                </table>
            </div>
        </div>
    </div>

    <script>
        document.getElementById('rateForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const payload = {
                source_pincode: parseInt(document.getElementById('source').value),
                dest_pincode: parseInt(document.getElementById('destination').value),
                weight: parseFloat(document.getElementById('weight').value),
                is_cod: document.getElementById('is_cod').checked,
                order_value: parseFloat(document.getElementById('value').value),
                mode: document.getElementById('mode').value
            };

            try {
                const response = await fetch('http://127.0.0.1:8000/compare-rates', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });
                
                const data = await response.json();
                displayResults(data);
            } catch (error) {
                alert('Error connecting to the API. Make sure FastAPI is running!');
            }
        });

        function displayResults(data) {
            const resultsArea = document.getElementById('resultsArea');
            const resultsBody = document.getElementById('resultsBody');
            const zoneBadge = document.getElementById('zoneBadge');
            
            resultsBody.innerHTML = '';
            resultsArea.classList.remove('hidden');

            if(data.length > 0) {
                zoneBadge.innerText = data[0].applied_zone;
            }

            data.forEach(item => {
                const row = `<tr>
                    <td class="px-6 py-4 font-medium text-gray-900">${item.carrier}</td>
                    <td class="px-6 py-4"><span class="px-2 py-1 rounded text-xs ${item.mode === 'Air' ? 'bg-purple-100 text-purple-700' : 'bg-green-100 text-green-700'}">${item.mode}</span></td>
                    <td class="px-6 py-4">₹${(item.breakdown.base_forward + item.breakdown.additional_weight).toFixed(2)}</td>
                    <td class="px-6 py-4">₹${item.breakdown.cod.toFixed(2)}</td>
                    <td class="px-6 py-4">₹${item.breakdown.gst.toFixed(2)}</td>
                    <td class="px-6 py-4 font-bold text-blue-600">₹${item.total_cost.toFixed(2)}</td>
                </tr>`;
                resultsBody.innerHTML += row;
            });
        }
    </script>
</body>
</html>